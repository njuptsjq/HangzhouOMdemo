(function(a){"object"===typeof module&&module.exports?module.exports=a:a(Highcharts)})(function(a){(function(d){function l(q,o,p,n,s,r){q=(r-o)*(p-q)-(n-o)*(s-q);return 0<q?!0:0>q?!1:!0}function k(r,o,q,n,u,s,t,p){return l(r,o,u,s,t,p)!==l(q,n,u,s,t,p)&&l(r,o,q,n,u,s)!==l(r,o,q,n,t,p)}function g(r,o,q,n,u,s,t,p){return k(r,o,r+q,o,u,s,t,p)||k(r+q,o,r+q,o+n,u,s,t,p)||k(r,o+n,r+q,o+n,u,s,t,p)||k(r,o,r,o+n,u,s,t,p)}function f(q){var o=this,p=Math.max(d.animObject(o.renderer.globalAnimation).duration,250),n=!o.hasRendered;q.apply(o,[].slice.call(arguments,1));o.labelSeries=[];clearTimeout(o.seriesLabelTimer);j(o.series,function(t){var r=t.labelBySeries,s=r&&r.closest;t.options.label.enabled&&t.visible&&(t.graph||t.area)&&(o.labelSeries.push(t),n&&(p=Math.max(p,d.animObject(t.options.animation).duration)),s&&(void 0!==s[0].plotX?r.animate({x:s[0].plotX+s[1],y:s[0].plotY+s[2]}):r.attr({opacity:0})))});o.seriesLabelTimer=setTimeout(function(){o.drawSeriesLabels()},p)}var e=d.wrap,j=d.each,b=d.extend,i=d.isNumber,c=d.Series,m=d.SVGRenderer,h=d.Chart;d.setOptions({plotOptions:{series:{label:{enabled:!0,connectorAllowed:!0,connectorNeighbourDistance:24,styles:{fontWeight:"bold"}}}}});m.prototype.symbols.connector=function(q,u,v,n,t){var r=t&&t.anchorX;t=t&&t.anchorY;var s,o,p=v/2;i(r)&&i(t)&&(s=["M",r,t],o=u-t,0>o&&(o=-n-o),o<v&&(p=r<q+v/2?o:v-o),t>u+n?s.push("L",q+p,u+n):t<u?s.push("L",q+p,u):r<q?s.push("L",q,u+n/2):r>q+v&&s.push("L",q+v,u+n/2));return s||[]};c.prototype.getPointsOnGraph=function(){var s=this.points,w,x,p=[],v,t,u,q;t=this.graph||this.area;u=t.element;var r=(w=this.chart.inverted)?this.yAxis.pos:this.xAxis.pos,o=w?this.xAxis.pos:this.yAxis.pos;if(this.getPointSpline&&u.getPointAtLength){t.toD&&(x=t.attr("d"),t.attr({d:t.toD}));q=u.getTotalLength();for(v=0;v<q;v+=16){w=u.getPointAtLength(v),p.push({chartX:r+w.x,chartY:o+w.y,plotX:w.x,plotY:w.y})}x&&t.attr({d:x});w=s[s.length-1];w.chartX=r+w.plotX;w.chartY=o+w.plotY;p.push(w)}else{for(q=s.length,v=0;v<q;v+=1){w=s[v];x=s[v-1];w.chartX=r+w.plotX;w.chartY=o+w.plotY;if(0<v&&(t=Math.abs(w.chartX-x.chartX),u=Math.abs(w.chartY-x.chartY),t=Math.max(t,u),16<t)){for(t=Math.ceil(t/16),u=1;u<t;u+=1){p.push({chartX:x.chartX+u/t*(w.chartX-x.chartX),chartY:x.chartY+u/t*(w.chartY-x.chartY),plotX:x.plotX+u/t*(w.plotX-x.plotX),plotY:x.plotY+u/t*(w.plotY-x.plotY)})}}i(w.plotY)&&p.push(w)}}return p};c.prototype.checkClearPoint=function(A,E,F,v){var D=Number.MAX_VALUE,B=Number.MAX_VALUE,C,w,y=this.options.label.connectorAllowed,u=this.chart,t,z,o,x;for(o=0;o<u.boxesToAvoid.length;o+=1){z=u.boxesToAvoid[o];x=A+F.width;t=E;var s=E+F.height;if(!(A>z.right||x<z.left||t>z.bottom||s<z.top)){return !1}}for(o=0;o<u.series.length;o+=1){if(t=u.series[o],z=t.interpolatedPoints,t.visible&&z){for(x=1;x<z.length;x+=1){if(g(A,E,F.width,F.height,z[x-1].chartX,z[x-1].chartY,z[x].chartX,z[x].chartY)){return !1}this===t&&!C&&v&&(C=g(A-16,E-16,F.width+32,F.height+32,z[x-1].chartX,z[x-1].chartY,z[x].chartX,z[x].chartY));this!==t&&(D=Math.min(D,Math.pow(A+F.width/2-z[x].chartX,2)+Math.pow(E+F.height/2-z[x].chartY,2),Math.pow(A-z[x].chartX,2)+Math.pow(E-z[x].chartY,2),Math.pow(A+F.width-z[x].chartX,2)+Math.pow(E-z[x].chartY,2),Math.pow(A+F.width-z[x].chartX,2)+Math.pow(E+F.height-z[x].chartY,2),Math.pow(A-z[x].chartX,2)+Math.pow(E+F.height-z[x].chartY,2)))}if(y&&this===t&&(v&&!C||D<Math.pow(this.options.label.connectorNeighbourDistance,2))){for(x=1;x<z.length;x+=1){C=Math.min(Math.pow(A+F.width/2-z[x].chartX,2)+Math.pow(E+F.height/2-z[x].chartY,2),Math.pow(A-z[x].chartX,2)+Math.pow(E-z[x].chartY,2),Math.pow(A+F.width-z[x].chartX,2)+Math.pow(E-z[x].chartY,2),Math.pow(A+F.width-z[x].chartX,2)+Math.pow(E+F.height-z[x].chartY,2),Math.pow(A-z[x].chartX,2)+Math.pow(E+F.height-z[x].chartY,2)),C<B&&(B=C,w=z[x])}C=!0}}}return !v||C?{x:A,y:E,weight:D-(w?B:0),connectorPoint:w}:!1};h.prototype.drawSeriesLabels=function(){var o=this,n=this.labelSeries;o.boxesToAvoid=[];j(n,function(p){p.interpolatedPoints=p.getPointsOnGraph();j(p.options.label.boxesToAvoid||[],function(q){o.boxesToAvoid.push(q)})});j(o.series,function(F){function E(q,p,r){return q>A&&q<=A+y-r.width&&p>=s&&p<=s+u-r.height}var D,B,C,x=[],z,w,v=o.inverted,A=v?F.yAxis.pos:F.xAxis.pos,s=v?F.xAxis.pos:F.yAxis.pos,y=o.inverted?F.yAxis.len:F.xAxis.len,u=o.inverted?F.xAxis.len:F.yAxis.len,G=F.interpolatedPoints,v=F.labelBySeries;if(F.visible&&G){v||(F.labelBySeries=v=o.renderer.label(F.name,0,-9999,"connector").css(b({color:F.color},F.options.label.styles)).attr({padding:0,opacity:0,stroke:F.color,"stroke-width":1}).add(F.group).animate({opacity:1},{duration:200}));D=v.getBBox();D.width=Math.round(D.width);for(w=G.length-1;0<w;--w){B=G[w].chartX+3,C=G[w].chartY-D.height-3,E(B,C,D)&&(z=F.checkClearPoint(B,C,D)),z&&x.push(z),B=G[w].chartX+3,C=G[w].chartY+3,E(B,C,D)&&(z=F.checkClearPoint(B,C,D)),z&&x.push(z),B=G[w].chartX-D.width-3,C=G[w].chartY+3,E(B,C,D)&&(z=F.checkClearPoint(B,C,D)),z&&x.push(z),B=G[w].chartX-D.width-3,C=G[w].chartY-D.height-3,E(B,C,D)&&(z=F.checkClearPoint(B,C,D)),z&&x.push(z)}if(!x.length){for(B=A+y-D.width;B>=A;B-=16){for(C=s;C<s+u-D.height;C+=16){(z=F.checkClearPoint(B,C,D,!0))&&x.push(z)}}}if(x.length){if(x.sort(function(q,p){return p.weight-q.weight}),z=x[0],o.boxesToAvoid.push({left:z.x,right:z.x+D.width,top:z.y,bottom:z.y+D.height}),Math.round(z.x)!==Math.round(v.x)||Math.round(z.y)!==Math.round(v.y)){F.labelBySeries.attr({opacity:0,x:z.x-A,y:z.y-s,anchorX:z.connectorPoint&&z.connectorPoint.plotX,anchorY:z.connectorPoint&&z.connectorPoint.plotY}).animate({opacity:1}),F.options.kdNow=!0,F.buildKDTree(),F=F.searchPoint({chartX:z.x,chartY:z.y},!0),v.closest=[F,z.x-A-F.plotX,z.y-s-F.plotY]}}else{v&&(F.labelBySeries=v.destroy())}}})};e(h.prototype,"render",f);e(h.prototype,"redraw",f)})(a)});